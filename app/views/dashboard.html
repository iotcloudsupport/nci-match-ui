<div ng-controller="DashboardController">

    <div class="row border-bottom white-bg dashboard-header animated fadeInRight statistics-row">
        <h2 class="welcome">Welcome, {{ name }}!</h2>

        <div class="col-sm-3 col-md-3" ng-init="loadDashboardData()">
            <div>
                <h3>Patients<br>Statistics</h3>
            </div>

            <div class="statistic-box dashboard">
                <ul class="list-group clear-list statistics m-t">
                    <li class="list-group-item fist-item">
                        <strong><span class="pull-right">{{ ::patientStatistics.number_of_patients }}</span></strong>
                        Registered Patients:
                    </li>
                    <li class="list-group-item">
                        <strong><span class="pull-right">{{ ::patientStatistics.number_of_patients_with_confirmed_variant_report }}</span></strong>
                        Patients with Confirmed Variant Report:
                    </li>
                    <li class="list-group-item">
                        <strong><span class="pull-right">{{ ::patientStatistics.number_of_patients_on_treatment_arm }}</span></strong>
                        Patients on Treatment:
                    </li>
                    <li class="list-group-item">
                        <strong><span class="pull-right">{{ pendingTissueVariantReportList.length }}</span></strong>
                        Pending Tissue Variant Reports:
                    </li>
                    <li class="list-group-item">
                        <strong><span class="pull-right">{{ pendingBloodVariantReportList.length }}</span></strong>
                        Pending Blood Variant Reports:
                    </li>
                    <li class="list-group-item">
                        <strong><span class="pull-right">{{ pendingAssignmentReportList.length }}</span></strong>
                        Pending Assignment Reports:
                    </li>
                </ul>
            </div>
        </div>

        <div class="col-sm-3 col-md-3" ng-init="setCanvasHeight('#amoiCanvas', 95);">
            <div class="text-center">
                <h3>Sequenced & Confirmed <br> Patients with aMOIs</h3>
            </div>
            <div class="statistic-box dashboard">
                <canvas id="amoiCanvas" doughnutchart options="donutOptions" ng-attr-data="donutData" legend="true" responsive="true"></canvas>

                <ul class="dashboard donut-chart-legend"><i class="fa fa-square" style="color: #23c6c8"></i>
                    0 aMOI : <strong>   {{amoi_0}} patients</strong> <br><i class="fa fa-square" style="color: #1c84c6"></i>
                    1 aMOI : <strong>   {{amoi_1}} patients</strong> <br><i class="fa fa-square" style="color: #18a689"></i>
                    2 aMOI : <strong>   {{amoi_2}} patients</strong> <br><i class="fa fa-square" style="color: #f8ac59"></i>
                    3 aMOI : <strong>   {{amoi_3}} patients</strong> <br><i class="fa fa-square" style="color: #707070"></i>
                    4 aMOI : <strong>   {{amoi_4}} patients</strong> <br><i class="fa fa-square" style="color: #cfcfcf"></i>
                    5+ aMOI : <strong>  {{amoi_5}} patients</strong> <br></ul>

            </div>
        </div>

        <div class="col-sm-6 col-md-6" ng-init="setCanvasHeight('#treatmentArmAccrualCanvas', 100);">
            <div class="text-center">
                <h3>Top 5 Treatment<br> Arm Accrual</h3>
            </div>
            <div id="chartBox" class="statistic-box dashboard">
                <canvas id="treatmentArmAccrualCanvas" barchart options="barOptions" ng-attr-data="barData" responsive="true"></canvas>
            </div>
        </div>

    </div>

    <div class="wrapper wrapper-dashboard">
        <div class="row">
            <div class="col-md-12">
                <div class="panel-container">
                    <div class="ibox-title ibox-title-no-line">
                        <h3>Pending Review </h3>
                    </div>
                    <div class="tabs-container no-tab-pane-border">
                        <uib-tabset>
                            <uib-tab heading="Tissue Variant Reports">                                
                                <div class="panel-body" ng-init="loadTissueVariantReportsList()">


                                    <div grid-data grid-options="gridOptions" grid-actions="gridActions">
                                        <!-- sample table layout goes below, but remember that you can you any mark-up here. -->
                                        <table class="table">
                                            <thead>
                                            <tr>
                                                <th>Patient ID</th>
                                                <th>Molecular ID</th>
                                                <th>Analysis ID</th>
                                                <th class="text-center">Variant Report</th>
                                                <th>CLIA Lab</th>
                                                <th>Specimen Received Date</th>
                                                <th>Variant Report Received Date</th>
                                                <th>Days Pending</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr grid-item>
                                                <td>
                                                    <a ui-sref="patient({ patient_id: item.patient_id })">
                                                        <i class="fa fa-user"></i> <span ng-bind="item.patient_id | dashify"></span> 
                                                    </a>
                                                </td>
                                                <td><a ui-sref="patient({ patient_id: item.patient_id, section: 'surgical_event', molecular_id: item.molecular_id, analysis_id: item.analysis_id })"><span ng-bind="item.molecular_id | dashify"></span></a></td>
                                                <td><a ui-sref="patient({ patient_id: item.patient_id, section: 'tissue_variant_report', molecular_id: item.molecular_id, analysis_id: item.analysis_id })"><span ng-bind="item.analysis_id | dashify"></span></a></td>
                                                <td class="text-center">
                                                    <a ui-sref="patient({ patient_id: item.patient_id, section: 'tissue_variant_report', molecular_id: item.molecular_id, analysis_id: item.analysis_id })" title="Variant Report">
                                                        <i class="fa fa-file-text-o"></i>
                                                    </a>
                                                </td>
                                                <td ng-switch="item.clia_lab">
                                                    <a ng-when="MoCha" ui-sref="clia-labs" ng-click="clialab('mocha')"><span ng-bind="item.clia_lab"></span></a>
                                                    <a ng-when="MDA" ui-sref="clia-labs" ng-click="clialab('mdacc')"><span ng-bind="item.clia_lab"></span></a>
                                                    <span ng-other>-</span>
                                                </td>
                                                <td ng-bind="item.specimen_received_date | utc"></td>
                                                <td ng-bind="item.variant_report_received_date | utc"></td>
                                                <td>
                                                    <number-color-badge value="item.days_pending" yellow-threshold="days_pending_range.upper_bound_green" red-threshold="days_pending_range.upper_bound_yellow"></number-color-badge>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>


                                    <table datatable="ng" dt-options="DashCtrl.ddOptions" dt-column-defs="DashCtrl.dtColumnDefs" dt-instance="DashCtrl.dtInstance"
                                        class="table table-striped table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th>Patient ID</th>
                                                <th>Molecular ID</th>
                                                <th>Analysis ID</th>
                                                <th class="text-center">Variant Report</th>
                                                <th>CLIA Lab</th>
                                                <th>Specimen Received Date</th>
                                                <th>Variant Report Received Date</th>
                                                <th>Days Pending</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="patient in pendingTissueVariantReportList">
                                                <td>
                                                    <a ui-sref="patient({ patient_id: patient.patient_id })">
                                                        <i class="fa fa-user"></i> {{::patient.patient_id | dashify }}
                                                    </a>
                                                </td>
                                                <td><a ui-sref="patient({ patient_id: patient.patient_id, section: 'surgical_event', molecular_id: patient.molecular_id, analysis_id: patient.analysis_id })">{{ patient.molecular_id | dashify }}</a></td>
                                                <td><a ui-sref="patient({ patient_id: patient.patient_id, section: 'tissue_variant_report', molecular_id: patient.molecular_id, analysis_id: patient.analysis_id })">{{ patient.analysis_id | dashify }}</a></td>
                                                <td class="text-center">
                                                    <a ui-sref="patient({ patient_id: patient.patient_id, section: 'tissue_variant_report', molecular_id: patient.molecular_id, analysis_id: patient.analysis_id })"
                                                        title="Variant Report">
                                                        <i class="fa fa-file-text-o"></i>
                                                    </a>
                                                </td>
                                                <td>
                                                    <a ng-if="patient.clia_lab === 'MoCha'" ui-sref="clia-labs" ng-click="clialab('mocha')">{{ patient.clia_lab | dashify }}</a>
                                                    <a ng-if="patient.clia_lab === 'MDA'" ui-sref="clia-labs" ng-click="clialab('mdacc')">{{ patient.clia_lab | dashify }}</a>
                                                </td>
                                                <td>{{ patient.specimen_received_date | utc }}</td>
                                                <td>{{ patient.variant_report_received_date | utc }}</td>
                                                <td><span ng-if="patient.days_pending >= days_pending_range.upper_bound_yellow"
                                                        class="label label-danger">{{ patient.days_pending }}</span>
                                                    <span ng-if="patient.days_pending < days_pending_range.upper_bound_yellow && patient.days_pending >= days_pending_range.upper_bound_green"
                                                        class="label label-warning">{{ patient.days_pending }}</span>
                                                    <span ng-if="patient.days_pending < days_pending_range.upper_bound_green" class="label label-primary">{{ patient.days_pending }}</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </uib-tab>
                            <uib-tab heading="Blood Variant Reports">
                                <div class="panel-body" ng-init="loadBloodVariantReportsList()">
                                    <table datatable="ng" dt-options="DashCtrl.ddOptions" dt-column-defs="DashCtrl.dtColumnDefs" dt-instance="DashCtrl.dtInstance"
                                        class="table table-striped table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th>Patient ID</th>
                                                <th>Molecular ID</th>
                                                <th>Analysis ID</th>
                                                <th class="text-center">Variant Report</th>
                                                <th>CLIA Lab</th>
                                                <th>Specimen Received Date</th>
                                                <th>Variant Report Received Date</th>
                                                <th>Days Pending</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="patient in pendingBloodVariantReportList">
                                                <td>
                                                    <a ui-sref="patient({ patient_id: patient.patient_id })">
                                                        <i class="fa fa-user"></i> {{::patient.patient_id | dashify }}
                                                    </a>
                                                </td>
                                                <td><a ui-sref="patient({ patient_id: patient.patient_id, section: 'surgical_event', molecular_id: patient.molecular_id, analysis_id: patient.analysis_id })">{{ patient.molecular_id | dashify }}</a></td>
                                                <td><a ui-sref="patient({ patient_id: patient.patient_id, section: 'blood_variant_report', molecular_id: patient.molecular_id, analysis_id: patient.analysis_id })">{{ patient.analysis_id | dashify }}</a></td>
                                                <td class="text-center">
                                                    <a ui-sref="patient({ patient_id: patient.patient_id, section: 'blood_variant_report', molecular_id: patient.molecular_id, analysis_id: patient.analysis_id })"
                                                        title="Variant Report">
                                                        <i class="fa fa-file-text-o"></i>
                                                    </a>
                                                </td>
                                                <td>
                                                    <a ng-if="patient.clia_lab === 'MoCha'" ui-sref="clia-labs" ng-click="clialab('mocha')">{{ patient.clia_lab | dashify }}</a>
                                                    <a ng-if="patient.clia_lab === 'MDA'" ui-sref="clia-labs" ng-click="clialab('mdacc')">{{ patient.clia_lab | dashify }}</a>
                                                </td>
                                                <td>{{ patient.specimen_received_date | utc }}</td>
                                                <td>{{ patient.variant_report_received_date | utc }}</td>
                                                <td><span ng-if="patient.days_pending >= days_pending_range.upper_bound_yellow"
                                                        class="label label-danger">{{ patient.days_pending }}</span>
                                                    <span ng-if="patient.days_pending < days_pending_range.upper_bound_yellow && patient.days_pending >= days_pending_range.upper_bound_green"
                                                        class="label label-warning">{{ patient.days_pending }}</span>
                                                    <span ng-if="patient.days_pending < days_pending_range.upper_bound_green" class="label label-primary">{{ patient.days_pending }}</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </uib-tab>
                            <uib-tab heading="Assignment Reports">
                                <div class="panel-body" ng-init="loadPatientPendingAssignmentReportsList()">
                                    <table datatable="ng" dt-options="DashCtrl.ddOptions" dt-column-defs="DashCtrl.dtColumnDefs" dt-instance="DashCtrl.dtInstance"
                                        class="table table-striped table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th>Patient ID</th>
                                                <th>Molecular ID</th>
                                                <th>Analysis ID</th>
                                                <th class="text-center">Assignment Report</th>
                                                <th>Disease</th>
                                                <th>Assigned Treatment Arm</th>
                                                <th>Assignment Date</th>
                                                <th>Hours Pending</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="patient in pendingAssignmentReportList">
                                                <td>
                                                    <a ui-sref="patient({ patient_id: patient.patient_id })">
                                                        <i class="fa fa-user"></i> {{::patient.patient_id }}
                                                    </a>
                                                </td>
                                                <td><a ui-sref="patient({ patient_id: patient.patient_id, section: 'surgical_event', molecular_id: patient.molecular_id, analysis_id: patient.analysis_id })">{{ patient.molecular_id | dashify }}</a></td>
                                                <td><a ui-sref="patient({ patient_id: patient.patient_id, section: 'assignment_report', molecular_id: patient.molecular_id, analysis_id: patient.analysis_id })">{{ patient.analysis_id | dashify }}</a></td>
                                                <td class="text-center">
                                                    <a ui-sref="patient({ patient_id: patient.patient_id, section: 'assignment_report', molecular_id: patient.molecular_id, analysis_id: patient.analysis_id })"
                                                        title="Assignment Report">
                                                        <i class="fa fa-file-text-o"></i>
                                                    </a>
                                                </td>
                                                <td>{{patient.disease | dashify }}</td>
                                                <td>
                                                    <treatment-arm-title name="patient.treatment_arm" stratum="patient.treatment_arm_stratum_id" version="patient.treatment_arm_version"></treatment-arm-title>
                                                </td>
                                                <td>{{ patient.assigned_date | utc }}</td>
                                                <td><span ng-if="patient.hours_pending >= hours_pending_range.upper_bound_yellow"
                                                        class="label label-danger">{{ patient.hours_pending }}</span>
                                                    <span ng-if="patient.hours_pending < hours_pending_range.upper_bound_yellow && patient.hours_pending >= hours_pending_range.upper_bound_green"
                                                        class="label label-warning">{{ patient.hours_pending }}</span>
                                                    <span ng-if="patient.hours_pending < hours_pending_range.upper_bound_green" class="label label-primary">{{ patient.hours_pending }}</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </uib-tab>
                        </uib-tabset>
                    </div>
                </div>
            </div>
        </div>

        <div class="row wrapper-dashboard">
            <div class="col-md-12" ng-controller="ActivityController as activity" ng-init="activity.startLoading(10)">

                <div class="ibox-title ibox-title-no-line activity-header-panel" id="activity-column">
                    <h3>Activity Feed</h3>
                    <small class="text-muted">Showing last 10 messages, last updated at {{activity.lastUpdated}}</small>
                </div>

                <div class="ibox-content inspinia-timeline" id="panding-items-column">
                    <div class="timeline-item" ng-repeat="timelineEvent in activity.data">
                        <timeline timeline-event="timelineEvent" type="timelineEvent.event_type" show-entity-id="true"></timeline>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>